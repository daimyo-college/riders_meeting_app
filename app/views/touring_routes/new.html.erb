<h1>New Touring Route</h1>

<div class="touring_new">
  <%= render 'form', touring_route: @touring_route %>
  <div id="map_new" style=" width: 800px; height: 500px"></div>
</div>
<%= link_to 'Back', touring_routes_path %>

<script>
    function initMap() {

      // マップの初期化
        var map = new google.maps.Map(document.getElementById('map_new'), {
          zoom: 9,
          center: {lat: 33.31478181566308, lng: 130.50810970427096}
        });

      // ツーリングルートのオブジェクト定義
        let routes ={};
        // クリックイベントを追加
        map.addListener('click', function(e) {


        // getClickLatLng(e.latLng, map);
        // マーカーを設置
        var marker = new google.maps.Marker({
        position: e.latLng,
        map: map
        });

        // チェックボタンの状態値でデータを表示
          let radio_btns = document.getElementsByName("RadioGroup");

          for(var i = 0; i < radio_btns.length; i++){
          
            if(radio_btns[i].checked) {
              switch(i){
                case 0:
                  deleteMarkers(routes.start);
                  routes.start = marker;
                  $('#touring_route_start_lat').val(e.latLng.lat());
                  $('#touring_route_start_lon').val(e.latLng.lng());
                  break;
                case 1:
                  deleteMarkers(routes.end);
                  routes.end = marker;
                  $('#touring_route_end_lat').val(e.latLng.lat());
                  $('#touring_route_end_lon').val(e.latLng.lng());
                  break;
                case 2:
                  deleteMarkers(routes.wp1);
                  routes.wp1 = marker;
                  $('#touring_route_wp1_lat').val(e.latLng.lat());
                  $('#touring_route_wp1_lon').val(e.latLng.lng());
                  break;
                case 3:
                  deleteMarkers(routes.wp2);
                  routes.wp2 = marker;
                  $('#touring_route_wp2_lat').val(e.latLng.lat());
                  $('#touring_route_wp2_lon').val(e.latLng.lng());
                  break;
                case 4:
                  deleteMarkers(routes.wp3);
                  routes.wp3 = marker;
                  $('#touring_route_wp3_lat').val(e.latLng.lat());
                  $('#touring_route_wp3_lon').val(e.latLng.lng());
                  break;
                default:
                  console.log(i,"check_btn error");
                break;
              }
            }
          } 
      });
    }

    // function getClickLatLng(lat_lng, map) {
    //   // マーカーを設置
    //   var marker = new google.maps.Marker({
    //     position: lat_lng,
    //     map: map
    //   });

      // 座標の中心をずらす
      // map.panTo(lat_lng);
    // }

    function deleteMarkers(marker_d) {
		  if(marker_d != null){
		    marker_d.setMap(null);
		  }
		  marker_d = null;
	}

  </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY']%>&callback=initMap" async defer></script>
