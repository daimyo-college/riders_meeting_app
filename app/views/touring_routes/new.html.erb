<div class="contents">
<h1>New Touring Route</h1>

<%= render 'form', touring_route: @touring_route %>

<div id="map" style=" width: 800px; height: 500px"></div>

<%= link_to 'Back', touring_routes_path %>

<script>
    function initMap() {

      // マップの初期化
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 9,
          center: {lat: 33.31478181566308, lng: 130.50810970427096}
        });
 
      // ツーリングルートのオブジェクト定義
        let routes ={};

        // クリックイベントを追加
        map.addListener('click', function(e) {
          getClickLatLng(e.latLng, map);

        // チェックボタンの状態値でデータを表示
          let radio_btns = document.getElementsByName("RadioGroup");

          for(var i = 0; i < radio_btns.length; i++){
          
            if(radio_btns[i].checked) {
              switch(i){
                case 0:
                  $('#touring_route_start_lat').val(e.latLng.lat());
                  routes.start_lat = e.latLng.lat();
                  $('#touring_route_start_lon').val(e.latLng.lng());
                  routes.start_lng = e.latLng.lng();
                  break;
                case 1:
                  $('#touring_route_end_lat').val(e.latLng.lat());
                  routes.end_lat = e.latLng.lat();
                  $('#touring_route_end_lon').val(e.latLng.lng());
                  routes.end_lng = e.latLng.lng();
                  break;
                case 2:
                  $('#touring_route_wp1_lat').val(e.latLng.lat());
                  routes.wp1_lat = e.latLng.lat();
                  $('#touring_route_wp1_lon').val(e.latLng.lng());
                  routes.wp1_lng = e.latLng.lng();
                  break;
                case 3:
                  $('#touring_route_wp2_lat').val(e.latLng.lat());
                  routes.wp2_lat = e.latLng.lat();
                  $('#touring_route_wp2_lon').val(e.latLng.lng());
                  routes.wp2_lng = e.latLng.lng();
                  break;
                case 4:
                  $('#touring_route_wp3_lat').val(e.latLng.lat());
                  routes.wp3 = e.latLng.lat();
                  $('#touring_route_wp3_lon').val(e.latLng.lng());
                  routes.wp3_lng = e.latLng.lng();
                  break;
                default:
                  console.log(i,"check_btn error");
                break;
              }
            }
          } 
      });
    }

    function getClickLatLng(lat_lng, map) {

      // マーカーを設置
      var marker = new google.maps.Marker({
        position: lat_lng,
        map: map
      });

      // 座標の中心をずらす
  
      map.panTo(lat_lng);
    }

  </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY']%>&callback=initMap" async defer></script>
